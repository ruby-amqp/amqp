<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en'>
  <head>
    <title>Using TLS (SSL) with Ruby amqp gem and RabbitMQ</title>
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <meta content='A dead easy to use RabbitMQ Ruby client' name='description' />
    <meta content='The Ruby RabbitMQ Client Maintainers Team' name='author' />
    <link href='/assets/stylesheets/bootstrap.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='/assets/stylesheets/bootstrap-responsive.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='/assets/stylesheets/sass/styles.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='/assets/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='http://fonts.googleapis.com/css?family=Signika+Negative:300,400,600' rel='stylesheet' type='text/css' />
    <script src='/assets/javascripts/jquery-1.7.min.js' type='text/javascript'></script>
    <script src='/assets/javascripts/toc.js'></script>
    <script src='/assets/javascripts/bootstrap-collapse.js'></script>
    <meta content='text/html;charset=utf-8' http-equiv='Content-Type' />
    <script type="text/javascript">
      if(!(window.location.hostname === "localhost")) {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-27153041-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
      }
    </script>
  </head>

  <body>
    <div class='navbar navbar-inverse navbar-fixed-top'>
      <div class='navbar-inner'>
        <div class='container-fluid'>
          <a class='btn btn-navbar' data-target='.nav-collapse' data-toggle='collapse'>
            <span class='icon-bar'></span>
            <span class='icon-bar'></span>
            <span class='icon-bar'></span>
          </a>
          <a class='brand' href='/'>Ruby amqp gem</a>
          <div class='nav-collapse'>
            <ul class='nav'>
            <li>
              <a href="/">Home</a>
            </li>
            <li>
              <a href="/articles/guides.html">All guides</a>
            </li>
            <li>
              <a href='/articles/community.html'>Community</a>
            </li>
            <li>
              <a href='http://rubybunny.info'>Bunny, an alternative client</a>
            </li>
            <li>
              <a href='https://github.com/ruby-amqp/amqp'>Code on Github</a>
            </li>
            <li>
              <a href='http://github.com/ruby-amqp'>Other RabbitMQ Ruby clients</a>
            </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class='container-fluid'>
      <div class='row-fluid'>
        <div class='span3'>
          <div class='well sidebar-nav'></div>
        </div>
        <div class='span9'>
          <h1>Using TLS (SSL) with Ruby amqp gem and RabbitMQ</h1>
          <h2 id="about-this-guide">About this guide</h2>

<p>This guide covers connection to RabbitMQ nodes using TLS (also known as
SSL) and related issues. This guide does not explain basic TLS concepts.
For that, refer to resources like <a href="https://developer.mozilla.org/en/Introduction_to_SSL">Introduction to
SSL</a> or <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">Wikipedia
page on TLS</a>.</p>

<h2 id="covered-versions">Covered versions</h2>

<p>This guide covers Ruby amqp gem 1.7.0 and later versions.</p>

<h2 id="rabbitmq-version-requirements">RabbitMQ Version Requirements</h2>

<p>RabbitMQ has supported TLS since version 1.7.0. Minimum requirements are</p>

<ul>
<li>Erlang R13B</li>
<li>Erlang SSL application 3.10</li>
</ul>

<p>The recommended distribution is R14B (SSL 4.0.1) or later. This should
be considered the minimum configuration for Java and Erlang clients due
to an incorrect RC4 implementation in earlier versions of Erlang.</p>

<p>Learn more at <a href="http://www.rabbitmq.com/ssl.html">rabbitmq.com TLS page</a>.</p>

<h2 id="pre-requisites">Pre-requisites</h2>

<p>RabbitMQ needs to be configured to use TLS. Just like Web
servers, TLS connections are usually accepted on a separate port (5671).
<a href="http://www.rabbitmq.com/ssl.html">rabbitmq.com TLS page</a> describes how
to configure RabbitMQ to use TLS, how to generate certificates for
development and so on.</p>

<h2 id="connecting-to-rabbitmq-using-tls">Connecting to RabbitMQ using TLS</h2>

<p>To instruct Ruby amqp gem to use TLS for connection, pass :ssl option
that specifies certificate chain file path as well as private key file
path:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">AMQP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="ss">:port</span>     <span class="o">=&gt;</span> <span class="mi">5671</span><span class="p">,</span>
           <span class="ss">:ssl</span> <span class="o">=&gt;</span> <span class="p">{</span>
             <span class="ss">:cert_chain_file</span>  <span class="o">=&gt;</span> <span class="n">certificate_chain_file_path</span><span class="p">,</span>
             <span class="ss">:private_key_file</span> <span class="o">=&gt;</span> <span class="n">client_private_key_file_path</span>
           <span class="p">})</span> <span class="k">do</span> <span class="o">|</span><span class="n">connection</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"Connected, authenticated. TLS seems to work."</span>

  <span class="n">connection</span><span class="p">.</span><span class="nf">disconnect</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Now closing the connectionâ€¦"</span><span class="p">;</span> <span class="no">EventMachine</span><span class="p">.</span><span class="nf">stop</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<p>Note that TLS connection may take a bit of time to establish (up to
several seconds in some cases). To verify that broker connection
actually uses TLS, refer to RabbitMQ log file:</p>
<div class="highlight"><pre><code class="language-" data-lang="">=INFO REPORT==== 28-Jun-2011::08:41:24 ===
accepted TCP connection on 0.0.0.0:5671 from 127.0.0.1:53444

=INFO REPORT==== 28-Jun-2011::08:41:24 ===
starting TCP connection &lt;0.9904.0&gt; from 127.0.0.1:53444

=INFO REPORT==== 28-Jun-2011::08:41:24 ===
upgraded TCP connection &lt;0.9904.0&gt; to SSL
</code></pre></div>
<h2 id="example-code">Example code</h2>

<p>TLS example (as well as sample certificates you can use to get started
with) can be found in the <a href="https://github.com/ruby-amqp/amqp/tree/master/examples">amqp gem git
repository</a></p>

        </div>
      </div>
    <footer class='footer'>
      <div class='container'>
        <p>This website was developed by the
          &nbsp;<a href='http://github.com/ruby-amqp'>Ruby RabbitMQ Client Maintainers Team</a>.</p>
        <p>Follow us on Twitter:
          &nbsp;<a href='http://twitter.com/rubyamqp'>rubyamqp</a>,&nbsp;<a href='http://twitter.com/michaelklishin'>Michael Klishin</a>,&nbsp;<a href='http://twitter.com/celldee'>Chris Duncan</a></p>
      </div>
    </footer>
  </body>
</html>
